<jqa:jqassistant-rules xmlns:jqa="http://www.buschmais.com/jqassistant/core/analysis/rules/schema/v1.0">

    <group id="jqa-project-layout">
        <includeConstraint refId="jqa-project-layout:readme:exists" />
        <includeConstraint refId="jqa-project-layout:documentation:releasenotes-exists" />
    </group>


    <constraint id="jqa-project-layout:readme:exists">
        <description><![CDATA[
            It must exist in the root directory of the project a
            readme file called 'readme.adoc'.

            This file will be displayed on Github while browsing
            the repositories.
            ]]></description>
        <cypher><![CDATA[
            MATCH
                (readme:File)

            WHERE
                readme.fileName =~ '/readme.adoc'

            RETURN
                CASE count(readme)
                    WHEN 1 THEN 0
                    ELSE 1
                END AS missing
        ]]></cypher>
        <verify>
            <aggregation column="missing"/>
        </verify>
    </constraint>

    <constraint id="jqa-project-layout:documentation:releasenotes-exists">
        <description><![CDATA[
There should be an Asciidoctor document for the release notes of this version.

]]></description>
        <cypher><![CDATA[
            MATCH
                (rp:RootProject:Maven)

            WITH
                '[/\\\\]src[/\\\\]main[/\\\\]asciidoc[/\\\\]' + split(rp.version,'-')[0] + '.adoc'
                AS requiredReleaseNotes

            MATCH
                (rl:File)

            WHERE
                rl.fileName =~ requiredReleaseNotes

            RETURN
                CASE count(rl)
                    WHEN 1 THEN 0
                    ELSE 1
                END AS missing
        ]]></cypher>
        <verify>
            <aggregation column="missing"/>
        </verify>
    </constraint>



</jqa:jqassistant-rules>
